<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image to PDF</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg: #0f172a;
  --card: #111827;
  --accent: #22c55e;
  --text: #e5e7eb;
  --muted: #9ca3af;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
}

.app {
  max-width: 480px;
  margin: auto;
  padding: 16px;
}

.header {
  text-align: center;
  margin-bottom: 20px;
}

.header h1 {
  font-size: 22px;
  margin: 0;
}

.header p {
  font-size: 13px;
  color: var(--muted);
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
}

input[type="file"] {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: 1px dashed #374151;
  background: #020617;
  color: var(--text);
}

button {
  width: 100%;
  padding: 14px;
  margin-top: 12px;
  border-radius: 12px;
  border: none;
  background: var(--accent);
  color: #052e16;
  font-size: 16px;
  font-weight: 600;
}

.pdf-item {
  display: flex;
  gap: 12px;
  align-items: center;
  background: #020617;
  padding: 10px;
  border-radius: 12px;
  margin-bottom: 10px;
}

.thumb {
  width: 52px;
  height: 70px;
  object-fit: cover;
  border-radius: 6px;
  background: #000;
}

.pdf-info {
  flex: 1;
}

.pdf-info div {
  font-size: 12px;
  color: var(--muted);
}

.pdf-item button {
  width: auto;
  padding: 8px 12px;
  font-size: 12px;
  background: #1f2933;
  color: var(--text);
}
</style>
</head>

<body>
<div class="app">

  <div class="header">
    <h1>Image → PDF</h1>
    <p>No ads • Private • On-device</p>
  </div>

  <div class="card">
    <input type="file" id="imgInput" accept="image/*" multiple>
    <button onclick="createPDF()">Create PDF</button>
  </div>

  <div class="card">
    <div id="pdfList"></div>
  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let db;

const req = indexedDB.open("ImageToPDF_DB", 1);
req.onupgradeneeded = e => {
  db = e.target.result;
  db.createObjectStore("pdfs", { keyPath: "id", autoIncrement: true });
};
req.onsuccess = e => {
  db = e.target.result;
  loadPDFs();
};

async function createPDF() {
  const files = document.getElementById("imgInput").files;
  if (!files.length) return alert("Select images");

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  // FIRST IMAGE = THUMBNAIL
  const thumbnail = await toBase64(files[0]);

  for (let i = 0; i < files.length; i++) {
    const imgData = await toBase64(files[i]);
    if (i > 0) pdf.addPage();

    const props = pdf.getImageProperties(imgData);
    const pw = pdf.internal.pageSize.getWidth();
    const ph = pdf.internal.pageSize.getHeight();

    const ratio = Math.min(pw / props.width, ph / props.height);
    const w = props.width * ratio;
    const h = props.height * ratio;

    pdf.addImage(imgData, "JPEG", (pw - w) / 2, (ph - h) / 2, w, h);
  }

  const blob = pdf.output("blob");
  savePDF(blob, thumbnail);
  pdf.save("images.pdf");
}

function savePDF(blob, thumbnail) {
  const tx = db.transaction("pdfs", "readwrite");
  tx.objectStore("pdfs").add({
    date: new Date().toLocaleString(),
    blob,
    thumbnail
  });
  tx.oncomplete = loadPDFs;
}

function loadPDFs() {
  const list = document.getElementById("pdfList");
  list.innerHTML = "";

  const tx = db.transaction("pdfs", "readonly");
  tx.objectStore("pdfs").openCursor().onsuccess = e => {
    const c = e.target.result;
    if (!c) return;

    const div = document.createElement("div");
    div.className = "pdf-item";
    div.innerHTML = `
      <img class="thumb" src="${c.value.thumbnail}">
      <div class="pdf-info">
        <div>${c.value.date}</div>
      </div>
      <button onclick="downloadPDF(${c.key})">Download</button>
    `;
    list.appendChild(div);
    c.continue();
  };
}

function downloadPDF(id) {
  const tx = db.transaction("pdfs", "readonly");
  tx.objectStore("pdfs").get(id).onsuccess = e => {
    const url = URL.createObjectURL(e.target.result.blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "saved.pdf";
    a.click();
  };
}

function toBase64(file) {
  return new Promise(res => {
    const r = new FileReader();
    r.onload = () => res(r.result);
    r.readAsDataURL(file);
  });
}
</script>
</body>
</html>


